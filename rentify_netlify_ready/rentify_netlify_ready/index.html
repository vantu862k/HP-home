<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rentify — Thuê nhà đơn giản</title>
  <meta name="description" content="Trang danh sách nhà cho thuê với ảnh, giá và địa chỉ.">
  <base href="./">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="header header--sticky">
    <div class="container header__row">
      <div class="logo">
        <img id="siteLogo" src="assets/logo.png" alt="Logo">
        <span id="siteName" class="brand-accent">Rentify</span>
      </div>
      <div class="header__actions"><a class="btn outline small" href="#">Đăng nhập</a></div>
    </div>
  </header>

  <section class="hero">
    <div class="hero__bg" id="heroBg"></div>
    <div class="container hero__content">
      <h1 id="heroHeadline" class="display">Ứng dụng tìm kiếm <span class="accent">phòng trọ</span> miễn phí</h1>
      <p id="heroSubhead">Tìm nhanh căn phù hợp theo giá, vị trí, tiện ích.</p>

      <div class="searchbox searchbox--pretty" role="search" aria-label="Bộ lọc tìm kiếm">
        <div class="searchbox__field grow">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="18" height="18"><circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="1.8"/><path d="m20 20-3.5-3.5" stroke="currentColor" stroke-width="1.8"/></svg>
          </span>
          <input id="q" placeholder="Tìm theo địa điểm, quận, tên đường…" aria-label="Từ khóa">
        </div>
        <div class="divider" aria-hidden="true"></div>
        <div class="searchbox__field"><span class="prefix">₫</span><input id="minp" type="number" inputmode="numeric" placeholder="Giá từ" aria-label="Giá từ"></div>
        <div class="divider" aria-hidden="true"></div>
        <div class="searchbox__field"><span class="prefix">₫</span><input id="maxp" type="number" inputmode="numeric" placeholder="Giá đến" aria-label="Giá đến"></div>
        <button id="doSearch" class="btn btn--primary" aria-label="Tìm kiếm">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/><path d="m20 20-3.5-3.5" stroke="currentColor" stroke-width="2"/></svg>
          <span>Tìm</span>
        </button>
      </div>
    </div>
  </section>

  <main class="container">
    <h2>Danh sách cho thuê</h2>
    <div id="grid" class="grid"></div>
  </main>

  <footer class="container footer">
    <div>© 2025 <span id="siteNameFooter">Rentify</span></div>
    <div id="contactWrap" class="contact">
      <div class="contact__bar">
        <a id="contactPhone" class="contact__item" href="#">
          <span class="ico" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.79 19.79 0 0 1 12 19a19.79 19.79 0 0 1-7.82 2.92A2 2 0 0 1 2 19.92v-3A2 2 0 0 1 3.72 15l3.18-.64a2 2 0 0 1 2.12 1l.7 1.23a16 16 0 0 0 6-6l-1.23-.7a2 2 0 0 1-1-2.12L9 3.72A2 2 0 0 1 9.64 2h3A2 2 0 0 1 14.6 3.4l.8 2.4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </span>
          <span class="txt" id="contactPhoneText">Gọi ngay</span>
          <span class="sub" id="contactPhoneSub"></span>
        </a>
        <span class="contact__sep" aria-hidden="true"></span>
        <a id="contactFb" class="contact__item" href="#" target="_blank" rel="noopener">
          <span class="ico" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24"><path d="M13.5 9H16V6h-2.5C11.6 6 11 7.3 11 9v2H9v3h2v7h3v-7h2.1l.4-3H14V9.6c0-.4.2-.6.5-.6Z" fill="currentColor"/></svg>
          </span>
          <span class="txt">Facebook</span>
          <span class="sub">/page</span>
        </a>
      </div>
    </div>
  </footer>

  <script>
    let CONFIG = {};

    function absolutize(src){
      if(!src) return src;
      if(/^https?:\/\//i.test(src)) return src;
      const base = (CONFIG.imagesBase || '').replace(/\/+$/,'');
      const clean = String(src).replace(/^assets\/images\/?/,'');
      return base ? base + '/' + clean : src;
    }

    const grid = document.getElementById('grid');
    const vnd = n => Number(n).toLocaleString('vi-VN') + ' đ/tháng';
    const cardHtml = l => {
      const cover = (l.images||[])[0]?.src || '';
      return `<a class="card" href="detail/index.html?id=${l.id}" aria-label="${l.title}">
        <img class="card__img" src="${cover}" alt="${l.title}" loading="lazy" decoding="async">
        <div class="card__body">
          <h2 class="card__title">${l.title}</h2>
          <div class="card__price">${vnd(l.price)}</div>
          <div class="card__addr">${l.address || ''}</div>
        </div>
      </a>`;
    };
    const render = list => grid.innerHTML = list.map(cardHtml).join('');

    function filter(list){
      const q = (document.getElementById('q').value||'').trim().toLowerCase();
      const minp = Number(document.getElementById('minp').value || 0);
      const maxp = Number(document.getElementById('maxp').value || Infinity);
      const filtered = list.filter(l=>{
        const text = `${l.title} ${l.address||''}`.toLowerCase();
        return text.includes(q) && l.price>=minp && l.price<=maxp;
      });
      render(filtered);
    }

    async function loadConfig(){
      const res = await fetch(`data/config.json?v=${Date.now()}`, {cache:'no-store'});
      CONFIG = await res.json();

      document.getElementById('siteLogo').src = CONFIG.logo || 'assets/logo.png';
      document.getElementById('siteName').textContent = CONFIG.siteName || 'Rentify';
      document.getElementById('siteNameFooter').textContent = CONFIG.siteName || 'Rentify';
      if (CONFIG.hero && CONFIG.hero.image) {
        document.getElementById('heroBg').style.backgroundImage = `url('${CONFIG.hero.image}')`;
      }

      const phone = CONFIG.contact?.phone || '';
      const fb    = CONFIG.contact?.facebook || '';
      const wrap  = document.getElementById('contactWrap');
      const phoneEl = document.getElementById('contactPhone');
      const phoneTxt = document.getElementById('contactPhoneText');
      const phoneSub = document.getElementById('contactPhoneSub');
      const fbEl  = document.getElementById('contactFb');

      if (phone) {
        const tel = 'tel:' + phone.replace(/\s+/g,'');
        phoneEl.href = tel;
        phoneTxt.textContent = 'Gọi ' + phone;
        phoneSub.textContent = 'Miễn phí';
      } else { phoneEl.style.display = 'none'; }

      if (fb) {
        fbEl.href = fb;
        try {
          const handle = new URL(fb).pathname.replace(/^\/+/, '') || 'Fanpage';
          fbEl.querySelector('.sub').textContent = '/' + handle;
        } catch(e) { fbEl.querySelector('.sub').textContent = ''; }
      } else { fbEl.style.display = 'none'; }

      if (!phone && !fb) wrap.style.display = 'none';
    }

    async function loadListings(){
      let data = [];
      try{
        const res = await fetch(`data/listings.json?v=${Date.now()}`, {cache:'no-store'});
        data = await res.json();
      }catch(e){ data = []; }
      data = data.map(l => ({...l, images: (l.images||[]).map(im => ({...im, src: absolutize(im.src)}))}));
      filter(data);
      document.getElementById('doSearch').addEventListener('click', ()=>filter(data));
    }

    (async function init(){
      await loadConfig();
      await loadListings();
    })();
  </script>
</body>
</html>
